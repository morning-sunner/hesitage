# å‰åç«¯æ•°æ®åº“è¿æ¥æ¶æ„å›¾

## ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æµè§ˆå™¨ç«¯ (Vue 3)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Views (HomeView, MapView, DetailView, ChatView)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Pinia Store (heritageStore)                         â”‚   â”‚
â”‚  â”‚  - currentProvince (å½“å‰çœä»½)                        â”‚   â”‚
â”‚  â”‚  - provinceData (çœä»½ç¡¬ç¼–ç æ•°æ®) âŒ éœ€è¦æ”¹ä¸ºåŠ¨æ€     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  API Utils (api.ts)                                  â”‚   â”‚
â”‚  â”‚  - heritageApi.getAll/getById/search()              â”‚   â”‚
â”‚  â”‚  - spatialApi.pointQuery/bufferQuery/withinRegion() â”‚   â”‚
â”‚  â”‚  - statisticsApi.getOverall/byCategory/byRegion()   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚ HTTP è¯·æ±‚                         â”‚
â”‚                          â”‚ (Fetch/Axios)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  http://localhost:3000/api          â”‚
        â”‚  âŒ è·¯ç”±æœªåœ¨ app.js ä¸­æ³¨å†Œ           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Express åç«¯                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app.js (éœ€è¦ä¿®å¤)                                   â”‚  â”‚
â”‚  â”‚  âœ… å·²æœ‰ indexRouter, usersRouter                    â”‚  â”‚
â”‚  â”‚  âŒ ç¼ºå°‘ heritageRouter, spatialRouter, etc.         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  routes/ (API è·¯ç”±)                                  â”‚  â”‚
â”‚  â”‚  âœ… heritage.js - éé—é¡¹ç›® CRUD + æœç´¢              â”‚  â”‚
â”‚  â”‚  âœ… spatial.js - ç©ºé—´æŸ¥è¯¢ (ç‚¹ã€ç¼“å†²åŒºã€åŒºåŸŸ)       â”‚  â”‚
â”‚  â”‚  âœ… statistics.js - ç»Ÿè®¡åˆ†æ                        â”‚  â”‚
â”‚  â”‚  âœ… users.js, index.js                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  config/database.js                                  â”‚  â”‚
â”‚  â”‚  PostgreSQL è¿æ¥æ± é…ç½®:                              â”‚  â”‚
â”‚  â”‚  - host: localhost                                   â”‚  â”‚
â”‚  â”‚  - port: 5432                                        â”‚  â”‚
â”‚  â”‚  - database: hositage  âš ï¸ æ³¨æ„å‘½å                  â”‚  â”‚
â”‚  â”‚  - user: postgres                                    â”‚  â”‚
â”‚  â”‚  - password: 0000                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PostgreSQL + PostGIS æ•°æ®åº“                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Database: hositage                        â”‚ â”‚
        â”‚  â”‚  Schema: shapefile                         â”‚ â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
        â”‚  â”‚  â”‚ Table: å›½å®¶çº§éé—ç‚¹ä½GCS_WGS_1984    â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Proj_num (é¡¹ç›®ç¼–å·)               â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Name_CN/Name_EN (é¡¹ç›®åç§°)        â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - CategoryCN/CategoryEN (åˆ†ç±»)      â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Time (å¹´ä»½)                       â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Type_CN/Type_EN (é¡¹ç›®ç±»å‹)        â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Place_CN/Place_EN (åœ°ç‚¹)          â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Unit_CN/Unit_EN (ä¿æŠ¤å•ä½)        â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - X, Y (ç»çº¬åº¦)                     â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - ProvinceCN/EN (çœä»½)              â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Region4CN/EN (åŒºåŸŸ4çº§)            â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - Region7CN/EN (åŒºåŸŸ7çº§)            â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ - geometry (PostGIS ç‚¹)             â”‚  â”‚ â”‚
        â”‚  â”‚  â”‚ âœ… åŒ…å« 3610 æ¡çœŸå®æ•°æ®              â”‚  â”‚ â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
        â”‚  â”‚                                             â”‚ â”‚
        â”‚  â”‚  Extensions: PostGIS, fuzzystrmatch         â”‚ â”‚
        â”‚  â”‚  Spatial Index: GIST on geometry            â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµç¤ºä¾‹

### åœºæ™¯ 1: å‰ç«¯è·å–æ‰€æœ‰éé—é¡¹ç›®

```
å‰ç«¯ (Vue)
  â”‚
  â”œâ”€> api.ts: heritageApi.getAll()
  â”‚     â””â”€> fetch('http://localhost:3000/api/heritage')
  â”‚
  â””â”€> HTTP GET /api/heritage
        â”‚
        â””â”€> Express åç«¯
              â”‚
              â”œâ”€> heritage.js è·¯ç”±å¤„ç† (éœ€è¦å…ˆæ³¨å†Œï¼)
              â”‚     â””â”€> db.query(`SELECT ... FROM heritage_items`)
              â”‚
              â””â”€> PostgreSQL
                    â”‚
                    â”œâ”€> æŸ¥è¯¢è¡¨: å›½å®¶çº§éé—ç‚¹ä½GCS_WGS_1984
                    â”‚
                    â””â”€> è¿”å›æ•°æ® (3610 æ¡è®°å½•)
```

### åœºæ™¯ 2: å‰ç«¯è¿›è¡Œç©ºé—´æŸ¥è¯¢ (ç‚¹å‡»åœ°å›¾)

```
å‰ç«¯ (Mapbox/Leaflet)
  â”‚
  â”œâ”€> ç”¨æˆ·ç‚¹å‡»åœ°å›¾ä½ç½® -> è·å– lng, lat
  â”‚
  â”œâ”€> api.ts: spatialApi.pointQuery(lng, lat, radius)
  â”‚     â””â”€> fetch('http://localhost:3000/api/spatial/point-query', {
  â”‚           lng, lat, radius
  â”‚         })
  â”‚
  â””â”€> HTTP POST /api/spatial/point-query
        â”‚
        â””â”€> Express åç«¯
              â”‚
              â”œâ”€> spatial.js è·¯ç”±å¤„ç† (éœ€è¦å…ˆæ³¨å†Œï¼)
              â”‚     â””â”€> db.query(`
              â”‚           SELECT ... FROM heritage_items
              â”‚           WHERE ST_DWithin(coordinates, POINT(...), radius)
              â”‚         `)
              â”‚
              â””â”€> PostgreSQL (PostGIS ç©ºé—´æŸ¥è¯¢)
                    â”‚
                    â””â”€> è¿”å›å‘¨å›´é¡¹ç›® (è·ç¦»æ’åº)
```

### åœºæ™¯ 3: å‰ç«¯è·å–ç»Ÿè®¡æ•°æ®

```
å‰ç«¯ (Pinia Store / ECharts)
  â”‚
  â”œâ”€> api.ts: statisticsApi.byCategory()
  â”‚     â””â”€> fetch('http://localhost:3000/api/statistics/by-category')
  â”‚
  â””â”€> HTTP GET /api/statistics/by-category
        â”‚
        â””â”€> Express åç«¯
              â”‚
              â”œâ”€> statistics.js è·¯ç”±å¤„ç† (éœ€è¦å…ˆæ³¨å†Œï¼)
              â”‚     â””â”€> db.query(`
              â”‚           SELECT category, COUNT(*) as count
              â”‚           FROM heritage_items
              â”‚           GROUP BY category
              â”‚         `)
              â”‚
              â””â”€> PostgreSQL
                    â”‚
                    â””â”€> è¿”å›åˆ†ç±»ç»Ÿè®¡æ•°æ®
```

## å½“å‰é—®é¢˜æ±‡æ€»

### ğŸ”´ Critical Issues

#### 1. åç«¯è·¯ç”±æœªæ³¨å†Œ
**ä½ç½®**: `backend/app.js`  
**é—®é¢˜**:
```javascript
// app.js ä¸­ç¼ºå°‘è¿™äº›:
const heritageRouter = require('./routes/heritage');
const spatialRouter = require('./routes/spatial');
const statisticsRouter = require('./routes/statistics');

app.use('/api/heritage', heritageRouter);
app.use('/api/spatial', spatialRouter);
app.use('/api/statistics', statisticsRouter);
```

**å½±å“**: æ‰€æœ‰ API è¯·æ±‚éƒ½ä¼šè¿”å› 404  
**ä¿®å¤**: åœ¨ app.js ä¸­æ·»åŠ è·¯ç”±æ³¨å†Œ

#### 2. è¡¨å/å­—æ®µåæ˜ å°„é”™è¯¯
**é—®é¢˜**:
- åç«¯ä»£ç æŸ¥è¯¢: `SELECT ... FROM shapefile.heritage_items`
- æ•°æ®åº“å®é™…è¡¨å: `shapefile."å›½å®¶çº§éé—ç‚¹ä½GCS_WGS_1984"`

**å½±å“**: æŸ¥è¯¢ä¼šæ‰¾ä¸åˆ°è¡¨  
**ä¿®å¤æ–¹æ¡ˆ A** (æ¨è): åˆ›å»ºè§†å›¾æˆ–é€‚é…å±‚
```sql
CREATE VIEW heritage_items AS
SELECT 
  ROW_NUMBER() OVER () as id,
  "Name_CN" as name,
  "CategoryCN" as category,
  "Place_CN" as location,
  ... 
FROM "å›½å®¶çº§éé—ç‚¹ä½GCS_WGS_1984";
```

**ä¿®å¤æ–¹æ¡ˆ B**: ç›´æ¥ä¿®æ”¹åç«¯æŸ¥è¯¢ä½¿ç”¨åŸè¡¨å

### ğŸŸ¡ Medium Issues

#### 3. å‰ç«¯çŠ¶æ€ç®¡ç†æœªä¸æ•°æ®åº“è¿æ¥
**ä½ç½®**: `front/src/stores/heritageStore.ts`  
**é—®é¢˜**: æ•°æ®å…¨æ˜¯ç¡¬ç¼–ç ï¼Œä¸ä¼šå®æ—¶æ›´æ–°  
**ä¿®å¤**: åœ¨ store ä¸­æ·»åŠ  API è°ƒç”¨æ–¹æ³•

#### 4. å­—æ®µæ˜ å°„ç­–ç•¥ä¸æ˜ç¡®
**é—®é¢˜**: æ•°æ®åº“æœ‰ Name_CN/Name_ENï¼Œå‰ç«¯å¦‚ä½•é€‰æ‹©ï¼Ÿ  
**ä¿®å¤**: åœ¨é€‚é…å±‚å®šä¹‰æ˜ç¡®çš„è¿”å›å­—æ®µè§„åˆ™

### ğŸŸ¢ Low Priority

#### 5. ä¸­è‹±æ–‡å†…å®¹å¤„ç†
éœ€è¦å®šä¹‰å‰ç«¯å›½é™…åŒ–ç­–ç•¥

## ä¿®å¤ä¼˜å…ˆçº§

1. âœ… **ç¬¬ä¸€æ­¥** (ä»Šå¤©): åœ¨ app.js ä¸­æ³¨å†Œè·¯ç”±
2. âœ… **ç¬¬äºŒæ­¥** (ä»Šå¤©): è§£å†³è¡¨åæ˜ å°„ (åˆ›å»ºè§†å›¾æˆ–æ”¹æŸ¥è¯¢)
3. âœ… **ç¬¬ä¸‰æ­¥** (ä»Šå¤©): æµ‹è¯•åç«¯ API æ˜¯å¦èƒ½æ­£å¸¸è¿”å›æ•°æ®
4. âœ… **ç¬¬å››æ­¥**: åœ¨å‰ç«¯ store ä¸­è°ƒç”¨ API è·å–åŠ¨æ€æ•°æ®
5. âœ… **ç¬¬äº”æ­¥**: ç«¯åˆ°ç«¯æµ‹è¯•æ•´ä¸ªç³»ç»Ÿ

