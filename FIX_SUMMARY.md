# ğŸ› ï¸ é•¿ä¸‰è§’éé—åœ°å›¾ - é—®é¢˜ä¿®å¤æ€»ç»“

## å‘ç°çš„é—®é¢˜æ¸…å•

### é—®é¢˜ 1ï¼šé¡µé¢æ˜¾ç¤ºå¾ˆçª„ï¼Œæ²¡æœ‰å…¨å±åœ°å›¾ âœ… **å·²ä¿®å¤**

**è¡¨ç°ï¼š** 
- å·¦ä¾§å·¥å…·æ å¾ˆå®½ï¼Œå æ®å¤§éƒ¨åˆ†ç©ºé—´
- åœ°å›¾å®¹å™¨åŒºåŸŸå¾ˆå°
- é¡µé¢æ•´ä½“è¢«é™åˆ¶åœ¨å¾ˆå°çš„å®½åº¦

**æ ¹æœ¬åŸå› ï¼š**
```
App.vue (#app å®¹å™¨)
  â”œâ”€ max-width: 1600px    â† é™åˆ¶æœ€å¤§å®½åº¦
  â”œâ”€ margin: 0 auto       â† å±…ä¸­å¯¹é½
  â””â”€ padding: 20px        â† å†…è¾¹è·æµªè´¹ç©ºé—´
     â””â”€ MapView.vue
        â”œâ”€ position: relative (åº”è¯¥æ˜¯ fixed)
        â””â”€ height: 100vh   â† ä½†å®é™…å— #app é™åˆ¶
```

**ä¿®å¤æ–¹æ¡ˆï¼š**

#### ä¿®æ”¹ 1: App.vue

**æ–‡ä»¶ï¼š** `hesitage/front/src/App.vue`

**æ”¹åŠ¨ï¼š**
```diff
  #app {
    position: relative;
    z-index: 2;
-   max-width: 1600px;
-   margin: 0 auto;
-   padding: 20px;
+   width: 100%;
+   height: 100%;
+   margin: 0;
+   padding: 0;
  }
```

**ä½œç”¨ï¼š** è®© #app å®¹å™¨å æ®æ•´ä¸ªè§†å£ï¼Œä¸å†é™åˆ¶å®½åº¦

#### ä¿®æ”¹ 2: MapView.vue - å®¹å™¨æ ·å¼

**æ–‡ä»¶ï¼š** `hesitage/front/src/views/MapView.vue`

**æ”¹åŠ¨ï¼š**
```diff
  .map-view-container {
-   position: relative;
-   width: 100%;
-   height: 100vh;
+   position: fixed;      // è„±ç¦»æ–‡æ¡£æµï¼Œå…¨å±æ˜¾ç¤º
+   top: 0;
+   left: 0;
+   width: 100%;
+   height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: #f0f0f0;
+   z-index: 100;         // ç¡®ä¿åœ¨æœ€é¡¶å±‚
  }
```

**ä½œç”¨ï¼š** åœ°å›¾å®¹å™¨ç‹¬å æ•´ä¸ªè§†å£

#### ä¿®æ”¹ 3: MapView.vue - åœ°å›¾å®¹å™¨é«˜åº¦

**æ–‡ä»¶ï¼š** `hesitage/front/src/views/MapView.vue`

**æ”¹åŠ¨ï¼š**
```diff
  .map-container {
    flex: 1;
    width: 100%;
-   height: calc(100vh - 60px);
+   height: 100%;          // flex ä¼šè‡ªåŠ¨è®¡ç®—
    background: white;
  }
```

**ä½œç”¨ï¼š** ç®€åŒ–é«˜åº¦è®¡ç®—ï¼Œä¾èµ– flex å¸ƒå±€

#### ä¿®æ”¹ 4: MapView.vue - éšè— NavBar

**æ–‡ä»¶ï¼š** `hesitage/front/src/views/MapView.vue`

**æ”¹åŠ¨ï¼š** åœ¨ `<script setup>` ä¸­æ·»åŠ ï¼š

```typescript
// éšè—å¯¼èˆªæ 
const appElement = ref<HTMLElement | null>(null)
onMounted(() => {
  const navbar = document.querySelector('.navbar-container') as HTMLElement
  if (navbar) {
    navbar.style.display = 'none'
  }
  appElement.value = document.querySelector('#app') as HTMLElement
  if (appElement.value) {
    appElement.value.style.padding = '0'
  }
})

onUnmounted(() => {
  const navbar = document.querySelector('.navbar-container') as HTMLElement
  if (navbar) {
    navbar.style.display = 'flex'
  }
  if (appElement.value) {
    appElement.value.style.padding = ''
  }
})
```

**ä½œç”¨ï¼š** è¿›å…¥åœ°å›¾é¡µé¢æ—¶éšè—å¯¼èˆªæ ï¼Œç¦»å¼€æ—¶æ¢å¤

---

### é—®é¢˜ 2ï¼šåç«¯ API è¿”å› 404 âš ï¸ **éœ€è¦è¯Šæ–­**

**ç—‡çŠ¶ï¼š**
```
GET http://localhost:3000/api/spatial/heatmap-data
â† 404 Not Found
```

**æ’æŸ¥ç»“æœï¼š**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åç«¯æœåŠ¡ | âœ“ è¿è¡Œä¸­ | localhost:3000 å“åº”æ­£å¸¸ |
| è·¯ç”±æ³¨å†Œ | âœ“ æ­£ç¡® | app.js ä¸­å·²æ³¨å†Œ `/api/spatial` |
| æ–‡ä»¶å­˜åœ¨ | âœ“ å­˜åœ¨ | spatial.js åŒ…å« heatmap-data ç«¯ç‚¹ |
| æ•°æ®åº“è¿æ¥ | â“ æœªéªŒè¯ | **éœ€è¦æ£€æŸ¥** |
| è¡¨æ˜¯å¦å­˜åœ¨ | â“ æœªéªŒè¯ | **éœ€è¦æ£€æŸ¥** |

**å¯èƒ½åŸå› åˆ†çº§ï¼š**

1. **é«˜æ¦‚ç‡ï¼ˆ80%ï¼‰** - æ•°æ®åº“è¿æ¥å¤±è´¥
   - PostgreSQL æœåŠ¡æœªè¿è¡Œ
   - æ•°æ®åº“ç”¨æˆ·/å¯†ç é”™è¯¯
   - æ•°æ®åº“ä¸å­˜åœ¨

2. **ä¸­æ¦‚ç‡ï¼ˆ15%ï¼‰** - è¡¨ä¸å­˜åœ¨æˆ–åç§°é”™è¯¯
   - è¡¨åï¼š`"é•¿ä¸‰è§’-å…¨éƒ¨_åœ°ç‚¹å”¯ä¸€_åœ°çº§å¸‚"`
   - Schemaï¼š`shapefile`
   - éœ€è¦éªŒè¯å®Œå…¨ä¸€è‡´

3. **ä½æ¦‚ç‡ï¼ˆ5%ï¼‰** - æƒé™é—®é¢˜
   - ç”¨æˆ·æ²¡æœ‰è¡¨è®¿é—®æƒé™

**è¯Šæ–­æ–¹æ³•ï¼š**

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd hesitage/backend

# 2. è¿è¡Œ API æµ‹è¯•
node scripts/testAPIs.js
```

**é¢„æœŸè¾“å‡ºï¼ˆæˆåŠŸï¼‰ï¼š**
```
âœ“ API è°ƒç”¨æˆåŠŸ
  â€¢ è¿”å›åŸå¸‚æ•°: 54
  â€¢ æ€»é¡¹ç›®æ•°: 513
```

**é¢„æœŸè¾“å‡ºï¼ˆå¤±è´¥ç¤ºä¾‹ï¼‰ï¼š**
```
âœ— API æµ‹è¯•å¤±è´¥
  connect ECONNREFUSED 127.0.0.1:5432
```

---

### é—®é¢˜ 3ï¼šç¯å¢ƒé…ç½® âš ï¸ **éœ€è¦æ£€æŸ¥**

**å…³é”®æ–‡ä»¶ï¼š** `hesitage/backend/.env`

**åº”è¯¥åŒ…å«ï¼š**
```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ä½ çš„å®é™…æ•°æ®åº“å
DB_USER=ä½ çš„æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
```

**æ£€æŸ¥æ–¹æ³•ï¼š**
```bash
cat hesitage/backend/.env
```

**å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š**
```bash
cd hesitage/backend
cat > .env << EOF
DB_HOST=localhost
DB_PORT=5432
DB_NAME=hositage
DB_USER=postgres
DB_PASSWORD=123456
EOF
```

---

## ä¿®å¤éªŒè¯æ¸…å•

### âœ… å‰ç«¯ä¿®å¤éªŒè¯

```bash
# 1. æ£€æŸ¥ä¿®æ”¹
grep "position: fixed" hesitage/front/src/views/MapView.vue
grep "width: 100%" hesitage/front/src/App.vue

# 2. å¯åŠ¨å‰ç«¯
cd hesitage/front
npm run dev

# 3. è®¿é—®åœ°å›¾
# æµè§ˆå™¨ï¼šhttp://localhost:5173/map

# 4. è§‚å¯Ÿï¼š
# âœ“ é¡µé¢å æ»¡æ•´ä¸ªæµè§ˆå™¨çª—å£
# âœ“ å·¦ä¾§å·¥å…·æ åˆç†å®½åº¦ï¼ˆ~260pxï¼‰
# âœ“ åœ°å›¾åŒºåŸŸå æ®å¤§éƒ¨åˆ†ç©ºé—´
# âœ“ å³ä¾§ä¿¡æ¯é¢æ¿ï¼ˆæ‚¬åœæ—¶æ˜¾ç¤ºï¼‰
```

### âš ï¸ åç«¯ä¿®å¤éªŒè¯

```bash
# 1. å¯åŠ¨åç«¯
cd hesitage/backend
npm start

# 2. è¿è¡Œ API æµ‹è¯•
node scripts/testAPIs.js

# 3. é¢„æœŸè¾“å‡º
# âœ“ API è°ƒç”¨æˆåŠŸ
# è¿”å›åŸå¸‚æ•°: 54
# æ€»é¡¹ç›®æ•°: 513

# 4. å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ï¼š
# - PostgreSQL æ˜¯å¦è¿è¡Œ
# - æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®
# - è¡¨æ˜¯å¦å­˜åœ¨
```

---

## ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

```
+------- #app (max-width: 1600px, padding: 20px) -------+
| +-------- MapView (position: relative) --------+      |
| | +--- toolbar ---+ +--------- map ---------+  |      |
| | | å¾ˆå®½å¾ˆå®½å®½  | |  å¾ˆå°çš„åœ°å›¾åŒºåŸŸ      |  |      |
| | +----------- ----+ +---------------------+  |      |
| +---------------------------------------- ----+      |
| å¤§é‡æµªè´¹çš„è¾¹è·                                         |
+-----------------------------------------------+
```

### ä¿®å¤å

```
+------ viewport (100%) ------+
| +-- MapView (fixed) -----+  |
| | +---+  +----------+    |  |
| | |å·¥| | |  åœ°å›¾    |  ä¿¡  |  |
| | |å…·| | |          |  æ¯  |  |
| | |æ | | |  (ECharts|  |  |
| | |  | | |  çƒ­åŠ›å›¾)|  é¢  |  |
| | +---+  +----------+    |  |
| +----------------------+  |
+---------------------------+
```

---

## æ–‡ä»¶ä¿®æ”¹æ‘˜è¦

### ä¿®æ”¹çš„æ–‡ä»¶

```
hesitage/front/src/App.vue
  â””â”€ ä¿®æ”¹ #app æ ·å¼ï¼ˆ3 è¡Œæ”¹åŠ¨ï¼‰

hesitage/front/src/views/MapView.vue
  â”œâ”€ ä¿®æ”¹ .map-view-container æ ·å¼
  â”œâ”€ ä¿®æ”¹ .map-container æ ·å¼
  â””â”€ æ·»åŠ  NavBar éšè—é€»è¾‘ï¼ˆonMounted/onUnmountedï¼‰
```

### æ–°å¢çš„æ–‡ä»¶

```
hesitage/backend/scripts/testAPIs.js
  â””â”€ API æµ‹è¯•è„šæœ¬ï¼ˆç”¨äºè¯Šæ–­ï¼‰

hesitage/DIAGNOSTIC_REPORT.md
  â””â”€ è¯Šæ–­æŠ¥å‘Šæ–‡æ¡£
```

---

## å¿«é€Ÿä¿®å¤æ­¥éª¤ï¼ˆé¢å‘ç”¨æˆ·ï¼‰

### ç¬¬ 1 æ­¥ï¼šé‡æ–°å¯åŠ¨å‰ç«¯ï¼ˆå·²ä¿®æ”¹ï¼‰

```bash
cd hesitage/front
npm run dev
```

### ç¬¬ 2 æ­¥ï¼šæ‰“å¼€æµè§ˆå™¨æµ‹è¯•

```
http://localhost:5173/map
```

### ç¬¬ 3 æ­¥ï¼šå¦‚æœåœ°å›¾ä¸æ˜¾ç¤ºæ•°æ®

```bash
# è¿è¡Œåç«¯ API æµ‹è¯•
cd hesitage/backend
node scripts/testAPIs.js
```

### ç¬¬ 4 æ­¥ï¼šæ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´

- **å¦‚æœ API æµ‹è¯•æˆåŠŸ** â†’ åˆ·æ–°å‰ç«¯é¡µé¢ï¼Œé—®é¢˜è§£å†³
- **å¦‚æœ API æµ‹è¯•å¤±è´¥** â†’ æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼ˆè§è¯Šæ–­æŠ¥å‘Šï¼‰

---

## å¯èƒ½é‡åˆ°çš„é—®é¢˜

### Q1: é¡µé¢ä»ç„¶å¾ˆçª„

**åŸå› ï¼š** ä¿®æ”¹æœªç”Ÿæ•ˆï¼ˆå¯èƒ½ç¼“å­˜é—®é¢˜ï¼‰

**è§£å†³ï¼š**
```bash
# 1. æ¸…é™¤ npm ç¼“å­˜
npm cache clean --force

# 2. åˆ é™¤ node_modules å’Œ dist
rm -rf hesitage/front/node_modules
rm -rf hesitage/front/dist

# 3. é‡æ–°å®‰è£…
npm install

# 4. é‡æ–°å¯åŠ¨
npm run dev

# 5. Ctrl+Shift+Delete æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
```

### Q2: ä»ç„¶çœ‹ä¸åˆ°åœ°å›¾

**åŸå› ï¼š** ECharts åˆå§‹åŒ–å¤±è´¥æˆ– API è¿”å› 404

**è§£å†³ï¼š**
```bash
# 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
# 2. æŸ¥çœ‹ Console é€‰é¡¹å¡æ˜¯å¦æœ‰é”™è¯¯
# 3. æŸ¥çœ‹ Network é€‰é¡¹å¡
#    - ç¡®è®¤ /api/spatial/heatmap-data è¿”å› 200 çŠ¶æ€
#    - æ£€æŸ¥å“åº”æ•°æ®æ˜¯å¦æ­£ç¡®

# 4. å¦‚æœæ˜¯ 404ï¼Œè¿è¡Œ
cd hesitage/backend
node scripts/testAPIs.js
```

### Q3: é¡µé¢é—ªçƒæˆ–åŠ è½½å¾ˆæ…¢

**åŸå› ï¼š** ECharts åœ°å›¾åº“å¤§å°è¾ƒå¤§

**è§£å†³ï¼š** è¿™æ˜¯æ­£å¸¸çš„ï¼Œç¬¬ä¸€æ¬¡åŠ è½½ä¼šéœ€è¦æ—¶é—´ã€‚åˆ·æ–°å‡ æ¬¡åº”è¯¥ä¼šç¼“å­˜ã€‚

---

## ä¸‹ä¸€æ­¥å»ºè®®

1. **ç«‹å³è¡ŒåŠ¨**
   - [ ] åº”ç”¨æ‰€æœ‰ä»£ç ä¿®æ”¹
   - [ ] é‡å¯å‰ç«¯æœåŠ¡
   - [ ] æµ‹è¯•é¡µé¢æ˜¾ç¤º

2. **è¯Šæ–­æ•°æ®åº“**
   - [ ] è¿è¡Œ `node scripts/testAPIs.js`
   - [ ] æ£€æŸ¥ API æ˜¯å¦è¿”å›æ•°æ®
   - [ ] å¦‚æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ .env é…ç½®

3. **éªŒè¯åŠŸèƒ½**
   - [ ] çƒ­åŠ›å›¾æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®
   - [ ] æ‚¬åœåŸå¸‚æ˜¯å¦æ˜¾ç¤ºä¿¡æ¯
   - [ ] ç‚¹å‡»çœä»½æ˜¯å¦ç¼©æ”¾

4. **ä¼˜åŒ–å’Œæ‰©å±•**
   - [ ] æ·»åŠ åŠ è½½åŠ¨ç”»
   - [ ] ä¼˜åŒ–æ€§èƒ½
   - [ ] æ·»åŠ é”™è¯¯å¤„ç†æç¤º

---

**æ›´æ–°æ—¥æœŸï¼š** 2024å¹´12æœˆ29æ—¥  
**ä¿®å¤çŠ¶æ€ï¼š** å‰ç«¯ âœ… å·²ä¿®å¤ï¼Œåç«¯ âš ï¸ éœ€è¯Šæ–­
