# Mapbox WebGIS 实现指南

## ✅ 已完成功能

### 1. 基础地图集成
- ✓ Mapbox GL 库的完整集成
- ✓ Token 配置（已内置）
- ✓ 长三角地区地图初始化（中心：120.5°E, 31.5°N）
- ✓ 初始缩放级别设置为 7（完整显示三省一市）

### 2. 底图切换功能
在工具栏顶部提供 5 种底图样式选择：
- 📍 **街道图** (Streets) - 默认
- 📍 **卫星图** (Satellite) - 遥感影像
- 📍 **地形图** (Terrain) - 地形等高线
- 📍 **浅色图** (Light) - 简洁配色
- 📍 **深色图** (Dark) - 深色主题

### 3. 非遗项目展示
- ✓ 7 个示例非遗项目（含昆曲、园林、丝绸等）
- ✓ GeoJSON 格式地理数据处理
- ✓ 圆形标记点渲染（金色 #d4a574）
- ✓ 项目名称标签显示
- ✓ 鼠标悬停交互反馈

### 4. 图层控制
- ✓ 省份图层显示/隐藏切换
- ✓ 非遗项目图层显示/隐藏切换
- ✓ 支持多图层管理

### 5. 查询功能

#### 点查询
1. 点击工具栏中的 "📍 点查询" 按钮激活模式
2. 在地图上点击任何非遗项目标记
3. 右下角面板显示查询结果
4. 支持多结果列表展示

#### 圆形查询（预留）
- 支持定义查询半径范围
- 缩小查询区域获取结果

### 6. 统计分析
- ✓ 总项目数统计
- ✓ 按分类统计（传统戏剧、工艺美术、传统技艺、传统建筑）
- ✓ 实时统计更新
- ✓ 动态面板显示/隐藏

### 7. 地区筛选
- ✓ 支持按省份筛选（江苏、浙江、上海、安徽、全部）
- ✓ 提供快速访问按钮组
- ✓ 预留省份特定项目过滤逻辑

### 8. 地图交互信息
- ✓ 实时显示鼠标位置坐标（经纬度）
- ✓ 显示当前缩放级别
- ✓ 位置信息面板自动更新

### 9. 高级交互
- ✓ **FlyTo 动画** - 点击结果项自动飞到该位置，缩放至 12 级
- ✓ **滚轮缩放** - 支持鼠标滚轮缩放
- ✓ **拖拽平移** - 支持地图拖拽移动
- ✓ **悬停效果** - 鼠标悬停在项目点时显示手指光标

## 🎯 UI 布局

### 工具栏（左上角）
```
┌─────────────────┐
│ 地图工具        │
│ 🗺️ 省份图层     │
│ 🎭 非遗项目     │
│                 │
│ 查询功能        │
│ 📍 点查询       │
│ ⭕ 圆形查询     │
│                 │
│ 统计分析        │
│ 📊 统计分析     │
│                 │
│ 底图切换        │
│ ▼ [街道图 ▼]   │
└─────────────────┘
```

### 地区选择（右上角）
```
┌─────────────────┐
│ 地区选择        │
│ [全部地区]      │
│ [江苏]          │
│ [浙江]          │
│ [上海]          │
│ [安徽]          │
└─────────────────┘
```

### 查询结果（右下角）
```
┌─────────────────┐
│ 查询结果    ✕   │
│ ┌─────────────┐ │
│ │ 昆曲        │ │
│ │ 传统戏剧    │ │
│ │ 苏州        │ │
│ └─────────────┘ │
└─────────────────┘
```

### 统计分析（左下角）
```
┌─────────────────┐
│ 统计分析    ✕   │
│ 总项目数：7     │
│ 按分类统计：    │
│ 传统戏剧：2     │
│ 工艺美术：2     │
│ 传统技艺：2     │
│ 传统建筑：1     │
└─────────────────┘
```

## 🔧 配置信息

### Mapbox Token
```javascript
mapboxgl.accessToken = 'pk.eyJ1IjoiY2hlbnlhbmd6aHUiLCJhIjoiY21qZ3gyd3NlMTd1YjNjb3JqNDNyb3Y5eSJ9.eVPOmxIjsx1Zm2DRZSAUqw'
```

### 长三角地区坐标范围
- **中心点**：120.5°E, 31.5°N
- **推荐缩放范围**：6-14 级
  - 6-7 级：显示整个长三角区域 + 周边
  - 8-10 级：显示单个省份或多个城市
  - 11-14 级：显示城市街道细节

## 📝 非遗项目数据

当前包含 7 个示例项目：

| 项目 | 分类 | 地点 | 坐标 |
|------|------|------|------|
| 昆曲 | 传统戏剧 | 苏州 | 120.595, 31.299 |
| 苏州园林 | 传统建筑 | 苏州 | 120.6, 31.3 |
| 杭州丝绸 | 工艺美术 | 杭州 | 120.155, 30.274 |
| 宣纸制作 | 传统技艺 | 宣城 | 118.757, 30.945 |
| 越剧 | 传统戏剧 | 绍兴 | 120.583, 30.003 |
| 徽墨制作 | 传统技艺 | 黄山 | 118.307, 30.137 |
| 龙泉青瓷 | 工艺美术 | 龙泉 | 119.169, 28.031 |

## 🚀 下一步计划

### 优先级 1：完善核心功能
- [ ] 从数据库加载真实非遗项目数据
- [ ] 实现圆形查询功能（使用 Turf.js）
- [ ] 实现矩形/自由绘制查询（使用 @mapbox/mapbox-gl-draw）
- [ ] 省份过滤逻辑完善

### 优先级 2：空间分析功能
- [ ] 热力图（Heatmap）显示
- [ ] 聚类显示（Cluster）
- [ ] 等级符号化显示
- [ ] 专题地图（Choropleth）

### 优先级 3：后端集成
- [ ] PostgreSQL + PostGIS 数据库
- [ ] Node.js API 服务器
- [ ] 空间查询接口 `/api/heritage/spatial-query`
- [ ] 统计分析接口 `/api/heritage/statistics`

### 优先级 4：高级功能
- [ ] 时间序列分析（非遗项目演变过程）
- [ ] 关联分析（项目与传承人的关系）
- [ ] 3D 地形可视化
- [ ] 多源数据融合

## 💻 使用方式

### 启动开发服务器
```bash
cd hesitage/front
npm install
npm run dev
```

然后在浏览器中访问 `http://localhost:5173/map`

### 生产构建
```bash
npm run build
```

## 🎨 配色方案

| 元素 | 颜色 | 用途 |
|------|------|------|
| 主色 | #d4a574 | 标记、按钮、统计值 |
| 文字 | #5a4f45 | 主要文本 |
| 背景 | #ffffff | 面板背景 |
| 浅灰 | #f5f5f5 | 按钮默认态 |
| 边框 | #ddd | 面板边框 |

## ❓ 常见问题

**Q: 地图不显示？**
A: 检查 Mapbox token 是否正确，确保网络连接正常。

**Q: 标记点不显示？**
A: 确保 GeoJSON 坐标格式正确（longitude, latitude）。

**Q: 点查询没有反应？**
A: 先点击 "点查询" 按钮激活模式（按钮会高亮），然后点击地图上的标记点。

**Q: 如何添加更多项目？**
A: 在 `heritageItems.ref` 中添加新项目对象，格式参考现有项目。

## 📚 参考资源

- [Mapbox GL JS 官方文档](https://docs.mapbox.com/mapbox-gl-js/)
- [GeoJSON 格式规范](https://geojson.org/)
- [PostGIS 空间数据库](https://postgis.net/)
- [Vue 3 组件指南](https://vuejs.org/)
