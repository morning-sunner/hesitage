# éé—å±•ç¤ºé¡µé¢åŠŸèƒ½å®Œå–„ - å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. åç«¯ API æ”¹é€ 
**æ–‡ä»¶**: `hesitage/backend/routes/heritage.js`

**æ”¹åŠ¨å†…å®¹**:
- ä¿®æ”¹ `GET /api/heritage` ç«¯ç‚¹
- ä»åŸè¡¨ `shapefile.heritage_items` æ”¹ä¸ºæŸ¥è¯¢ `shapefile."é•¿ä¸‰è§’-å…¨éƒ¨_åœ°ç‚¹å”¯ä¸€_åœ°çº§å¸‚"`
- è¿”å›ä»¥ä¸‹å­—æ®µï¼š
  - `name_cn` - éé—é¡¹ç›®åç§°
  - `categorycn` - åˆ†ç±»
  - `place_merged` - åœ°å€
  - `provincecn` - çœä»½
  - `image_url` - å›¾ç‰‡ URL
  - `intro` - é¡¹ç›®ç®€ä»‹
  - `x, y` - ç»çº¬åº¦

**æ”¯æŒçš„æŸ¥è¯¢å‚æ•°**:
```
GET /api/heritage?province=æ±Ÿè‹&category=ä¼ ç»Ÿæˆå‰§&search=æ˜†æ›²&limit=9&offset=0
```

### 2. å‰ç«¯ç»„ä»¶æ”¹é€ 
**æ–‡ä»¶**: `hesitage/front/src/views/HeritageView.vue`

**æ”¹åŠ¨å†…å®¹**:
1. **æ•°æ®è·å–**
   - æ·»åŠ  `fetchHeritageItems()` æ–¹æ³•ï¼Œä» API åŠ¨æ€åŠ è½½æ•°æ®
   - åœ¨ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨è°ƒç”¨ `onMounted()`
   - æ”¯æŒæŒ‰çœä»½ã€åˆ†ç±»ã€å…³é”®è¯æœç´¢

2. **æ•°æ®ç»‘å®š**
   - å¡ç‰‡åç§°: ç»‘å®š `name_cn`
   - å¡ç‰‡å›¾ç‰‡: ç»‘å®š `image_url`
   - å¡ç‰‡åˆ†ç±»: ç»‘å®š `categorycn`
   - å¡ç‰‡åœ°å€: ç»‘å®š `place_merged`
   - å¡ç‰‡ç®€ä»‹: ç»‘å®š `intro`

3. **äº¤äº’æ”¹è¿›**
   - åˆ†é¡µåŠ¨æ€ä» API è·å–æ•°æ®
   - æœç´¢ã€ç­›é€‰æ—¶è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
   - åŠ è½½çŠ¶æ€æç¤º

### 3. API å·¥å…·æ”¹é€ 
**æ–‡ä»¶**: `hesitage/front/src/utils/api.ts`

**æ·»åŠ é€šç”¨ API æ–¹æ³•**:
```typescript
api.get(url, options)   // GET è¯·æ±‚
api.post(url, data)     // POST è¯·æ±‚
api.put(url, data)      // PUT è¯·æ±‚
api.delete(url, options) // DELETE è¯·æ±‚
```

---

## ğŸ¯ é¡µé¢å¡ç‰‡ç°åœ¨æ˜¾ç¤ºçš„å†…å®¹

| å…ƒç´  | æ•°æ®æ¥æº | å­—æ®µå |
|------|--------|--------|
| **å¡ç‰‡åç§°** | æ•°æ®åº“ | `name_cn` |
| **å¡ç‰‡å›¾ç‰‡** | æ•°æ®åº“ | `image_url` |
| **åˆ†ç±»æ ‡ç­¾** | æ•°æ®åº“ | `categorycn` |
| **åœ°å€ä¿¡æ¯** | æ•°æ®åº“ | `place_merged` |
| **é¡¹ç›®ç®€ä»‹** | æ•°æ®åº“ | `intro` |

---

## ğŸ“‹ API è¯·æ±‚æµç¨‹

### åˆå§‹åŠ è½½
```
é¡µé¢æŒ‚è½½
  â†“
fetchHeritageItems()
  â†“
GET /api/heritage?limit=9&offset=0
  â†“
è¿”å›æ•°æ®ï¼Œç»‘å®šåˆ°å¡ç‰‡
  â†“
æ˜¾ç¤ºç¬¬ 1 é¡µçš„ 9 ä¸ªé¡¹ç›®
```

### æœç´¢/ç­›é€‰
```
ç”¨æˆ·è¾“å…¥æœç´¢è¯æˆ–é€‰æ‹©åˆ†ç±»
  â†“
currentPage = 1 é‡ç½®
  â†“
fetchHeritageItems()
  â†“
GET /api/heritage?province=X&category=Y&search=Z&limit=9&offset=0
  â†“
è¿”å›åŒ¹é…çš„æ•°æ®
  â†“
æ›´æ–°å¡ç‰‡åˆ—è¡¨
```

### åˆ†é¡µ
```
ç”¨æˆ·ç‚¹å‡»ä¸‹ä¸€é¡µ
  â†“
currentPage = 2
  â†“
fetchHeritageItems() // offset = 9
  â†“
GET /api/heritage?limit=9&offset=9
  â†“
è¿”å›ç¬¬ 10-18 é¡¹çš„æ•°æ®
```

---

## ğŸ”§ å…³é”®ä»£ç ç¤ºä¾‹

### åç«¯ - æŸ¥è¯¢æ•°æ®åº“
```javascript
const result = await db.query(`
  SELECT 
    name_cn,
    categorycn,
    place_merged,
    image_url,
    intro,
    x, y
  FROM shapefile."é•¿ä¸‰è§’-å…¨éƒ¨_åœ°ç‚¹å”¯ä¸€_åœ°çº§å¸‚"
  WHERE name_cn IS NOT NULL
  AND provincecn = $1
  AND categorycn LIKE $2
  LIMIT 9 OFFSET 0
`, ['æ±Ÿè‹', '%ä¼ ç»Ÿ%']);
```

### å‰ç«¯ - æ•°æ®ç»‘å®š
```vue
<div
  v-for="item in paginatedItems"
  :key="item.id"
  class="heritage-card"
>
  <div class="card-image-wrapper">
    <img :src="item.image" :alt="item.name" />
  </div>
  <div class="card-info">
    <h3>{{ item.name }}</h3>           <!-- name_cn -->
    <p>{{ item.category }}</p>         <!-- categorycn -->
    <p>{{ item.location }}</p>         <!-- place_merged -->
  </div>
</div>
```

---

## âœ¨ ç°åœ¨å¯ä»¥åšä»€ä¹ˆ

### âœ… æ˜¾ç¤ºçœŸå®æ•°æ®
- å¡ç‰‡åç§°è‡ªåŠ¨ä»æ•°æ®åº“ `name_cn` è·å–
- å¡ç‰‡å›¾ç‰‡è‡ªåŠ¨ä»æ•°æ®åº“ `image_url` åŠ è½½
- åˆ†ç±»ã€åœ°å€ç­‰ä¿¡æ¯å®Œå…¨åŠ¨æ€åŒ–

### âœ… æœç´¢å’Œç­›é€‰
- æŒ‰çœä»½ç­›é€‰ï¼ˆæ±Ÿè‹ã€æµ™æ±Ÿã€ä¸Šæµ·ã€å®‰å¾½ï¼‰
- æŒ‰åˆ†ç±»ç­›é€‰ï¼ˆä¼ ç»Ÿæˆå‰§ã€å·¥è‰ºç¾æœ¯ç­‰ï¼‰
- æŒ‰å…³é”®è¯æœç´¢ï¼ˆé¡¹ç›®åç§°æˆ–ç®€ä»‹ï¼‰

### âœ… åˆ†é¡µæµè§ˆ
- æ¯é¡µæ˜¾ç¤º 9 é¡¹ï¼Œå¯ç¿»é¡µæŸ¥çœ‹å…¨éƒ¨ 500+ é¡¹ç›®
- åˆ†é¡µæ•°æ®ä»æœåŠ¡å™¨åŠ¨æ€åŠ è½½

---

## ğŸš€ ä¸‹ä¸€æ­¥å¯ä»¥åšçš„

1. **ä¼˜åŒ–å›¾ç‰‡åŠ è½½**
   - æ·»åŠ å›¾ç‰‡æ‡’åŠ è½½
   - å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé»˜è®¤å›¾

2. **å¢å¼ºç”¨æˆ·ä½“éªŒ**
   - æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰
   - æœ€è¿‘æµè§ˆè®°å½•
   - æ”¶è—åŠŸèƒ½

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ ç¼“å­˜ç­–ç•¥
   - è™šæ‹Ÿæ»šåŠ¨åŠ è½½ï¼ˆå¤§æ•°æ®é‡åœºæ™¯ï¼‰
   - é¢„åŠ è½½ç›¸é‚»é¡µé¢

4. **æ•°æ®è¡¥å…¨**
   - å¦‚æœæ•°æ®åº“ä¸­ `image_url` ä¸ºç©ºï¼Œå¯ä»¥é…åˆä¹‹å‰çš„å›¾ç‰‡å¯¼å…¥è„šæœ¬å¡«å……
   - æ£€æŸ¥ `categorycn` å’Œ `place_merged` çš„æ•°æ®å®Œæ•´æ€§

---

## ğŸ“ æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨åç«¯
```bash
cd hesitage/backend
npm start
```

### 2. å¯åŠ¨å‰ç«¯
```bash
cd hesitage/front
npm run dev
```

### 3. æ‰“å¼€æµè§ˆå™¨
è®¿é—® `http://localhost:5173`ï¼Œå¯¼èˆªåˆ°éé—é¡¹ç›®é¡µé¢

### 4. éªŒè¯åŠŸèƒ½
- [ ] å¡ç‰‡åç§°æ˜¾ç¤ºæ­£ç¡®ï¼ˆä» `name_cn` è·å–ï¼‰
- [ ] å¡ç‰‡å›¾ç‰‡åŠ è½½æˆåŠŸï¼ˆä» `image_url` åŠ è½½ï¼‰
- [ ] åˆ†ç±»æ˜¾ç¤ºæ­£ç¡®ï¼ˆä» `categorycn` è·å–ï¼‰
- [ ] åœ°å€æ˜¾ç¤ºæ­£ç¡®ï¼ˆä» `place_merged` è·å–ï¼‰
- [ ] æœç´¢åŠŸèƒ½å¯ç”¨
- [ ] ç­›é€‰åŠŸèƒ½å¯ç”¨
- [ ] åˆ†é¡µåŠŸèƒ½å¯ç”¨

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¡ç‰‡æ˜¾ç¤ºç©ºç™½æˆ–æŠ¥é”™ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ (`npm start`)
2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. è¡¨ `shapefile."é•¿ä¸‰è§’-å…¨éƒ¨_åœ°ç‚¹å”¯ä¸€_åœ°çº§å¸‚"` æ˜¯å¦å­˜åœ¨
4. `name_cn` å­—æ®µæ˜¯å¦æœ‰æ•°æ®

### Q: å›¾ç‰‡ä¸æ˜¾ç¤ºï¼Ÿ
**A**: 
1. æ£€æŸ¥æ•°æ®åº“ä¸­ `image_url` æ˜¯å¦æœ‰å€¼
2. å¦‚æœä¸ºç©ºï¼Œè¿è¡Œä¹‹å‰çš„å›¾ç‰‡å¯¼å…¥è„šæœ¬ `sync-images-from-http.js`
3. æ£€æŸ¥æœåŠ¡å™¨å›¾ç‰‡è·¯å¾„æ˜¯å¦æ­£ç¡®

### Q: åˆ†é¡µä¸å·¥ä½œï¼Ÿ
**A**: 
1. æ£€æŸ¥åˆ†é¡µæŒ‰é’®æ˜¯å¦è§¦å‘ `fetchHeritageItems()`
2. æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®å¤„ç† `limit` å’Œ `offset` å‚æ•°
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `hesitage/backend/routes/heritage.js` | åç«¯éé— API è·¯ç”± |
| `hesitage/front/src/views/HeritageView.vue` | å‰ç«¯éé—å±•ç¤ºé¡µé¢ |
| `hesitage/front/src/utils/api.ts` | API å·¥å…·æ–¹æ³• |
| `DATABASE_VIEW_SETUP.sql` | æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ |

